{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- SEO Meta Tags -->
    <title>
      {% block title %}Vics Royal Beauty - Premium Hair Care Destination{%endblock %}
    </title>
    <meta
      name="description"
      content="{% block meta_description %}Vics Royal Beauty offers premium hair care products and accessories. Shop the latest trends in Nigerian hair care with fast delivery and excellent customer service.{% endblock %}"
    />
    <meta
      name="keywords"
      content="{% block meta_keywords %}hair care, premium hair products, Nigerian hair care, hair accessories, Vics Royal Beauty, human hair, wigs, hair extensions, hair bundles{% endblock %}"
    />
    <meta name="author" content="Vics Royal Beauty" />
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    <meta name="googlebot" content="index, follow" />
    
    <!-- Open Graph / Facebook -->
    <meta
      property="og:type"
      content="{% block og_type %}website{% endblock %}"
    />
    <meta property="og:url" content="{{ request.build_absolute_uri }}" />
    <meta
      property="og:title"
      content="{% block og_title %}{{ block.super }}{% endblock %}"
    />
    <meta
      property="og:description"
      content="{% block og_description %}{{ block.super }}{% endblock %}"
    />
    <meta
      property="og:image"
      content="{% block og_image %}{{ request.scheme }}://{{ request.get_host }}{% static 'images/logo.jpg' %}{% endblock %}"
    />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:site_name" content="Vics Royal Beauty" />
    <meta property="og:locale" content="en_US" />
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="{{ request.build_absolute_uri }}" />
    <meta
      name="twitter:title"
      content="{% block twitter_title %}{{ block.super }}{% endblock %}"
    />
    <meta
      name="twitter:description"
      content="{% block twitter_description %}{{ block.super }}{% endblock %}"
    />
    <meta
      name="twitter:image"
      content="{% block twitter_image %}{{ block.super }}{% endblock %}"
    />
    <meta name="twitter:site" content="@vicsroyalbeauty" />
    <meta name="twitter:creator" content="@vicsroyalbeauty" />
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{{ request.build_absolute_uri }}" />
    
    <!-- Favicon and Icons -->
    <!-- Standard Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}" />
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/favicon-16x16.png' %}" />
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/favicon-32x32.png' %}" />
    <link rel="icon" type="image/png" sizes="96x96" href="{% static 'images/favicon-96x96.png' %}" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="{% static 'images/apple-icon-57x57.png' %}" />
    <link rel="apple-touch-icon" sizes="60x60" href="{% static 'images/apple-icon-60x60.png' %}" />
    <link rel="apple-touch-icon" sizes="72x72" href="{% static 'images/apple-icon-72x72.png' %}" />
    <link rel="apple-touch-icon" sizes="76x76" href="{% static 'images/apple-icon-76x76.png' %}" />
    <link rel="apple-touch-icon" sizes="114x114" href="{% static 'images/apple-icon-114x114.png' %}" />
    <link rel="apple-touch-icon" sizes="120x120" href="{% static 'images/apple-icon-120x120.png' %}" />
    <link rel="apple-touch-icon" sizes="144x144" href="{% static 'images/apple-icon-144x144.png' %}" />
    <link rel="apple-touch-icon" sizes="152x152" href="{% static 'images/apple-icon-152x152.png' %}" />
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/apple-icon-180x180.png' %}" />
    <link rel="apple-touch-icon" href="{% static 'images/apple-icon.png' %}" />
    <link rel="apple-touch-icon-precomposed" href="{% static 'images/apple-icon-precomposed.png' %}" />
    
    <!-- Android Icons -->
    <link rel="icon" type="image/png" sizes="36x36" href="{% static 'images/android-icon-36x36.png' %}" />
    <link rel="icon" type="image/png" sizes="48x48" href="{% static 'images/android-icon-48x48.png' %}" />
    <link rel="icon" type="image/png" sizes="72x72" href="{% static 'images/android-icon-72x72.png' %}" />
    <link rel="icon" type="image/png" sizes="96x96" href="{% static 'images/android-icon-96x96.png' %}" />
    <link rel="icon" type="image/png" sizes="144x144" href="{% static 'images/android-icon-144x144.png' %}" />
    <link rel="icon" type="image/png" sizes="192x192" href="{% static 'images/android-icon-192x192.png' %}" />
    
    <!-- Microsoft Icons -->
    <link rel="icon" type="image/png" sizes="70x70" href="{% static 'images/ms-icon-70x70.png' %}" />
    <link rel="icon" type="image/png" sizes="144x144" href="{% static 'images/ms-icon-144x144.png' %}" />
    <link rel="icon" type="image/png" sizes="150x150" href="{% static 'images/ms-icon-150x150.png' %}" />
    <link rel="icon" type="image/png" sizes="310x310" href="{% static 'images/ms-icon-310x310.png' %}" />
    
    <!-- Microsoft Tile Color -->
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="msapplication-TileImage" content="{% static 'images/ms-icon-144x144.png' %}" />
    <meta name="msapplication-config" content="{% static 'images/browserconfig.xml' %}" />
    
    <!-- DNS Prefetch and Preconnect -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com" />
    <link rel="dns-prefetch" href="//fonts.gstatic.com" />
    <link rel="dns-prefetch" href="//cdn.tailwindcss.com" />
    <link rel="dns-prefetch" href="//res.cloudinary.com" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://res.cloudinary.com" />
    
    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
    {% block extra_css %}{% endblock %}
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="{% static 'images/logo.jpg' %}" as="image" />
    <link rel="preload" href="{% static 'css/styles.css' %}" as="style" />
    
    <!-- Schema.org Markup -->
    {% block schema_markup %}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "Vics Royal Beauty",
        "url": "{{ request.scheme }}://{{ request.get_host }}",
        "logo": "{{ request.scheme }}://{{ request.get_host }}{% static 'images/logo.jpg' %}",
        "description": "Premium hair care products and accessories in Nigeria",
        "foundingDate": "2024",
        "contactPoint": {
            "@type": "ContactPoint",
            "telephone": "+234-XXX-XXX-XXXX",
            "contactType": "customer service",
            "availableLanguage": "English"
        },
        "address": {
            "@type": "PostalAddress",
            "addressCountry": "NG",
            "addressLocality": "Lagos",
            "addressRegion": "Lagos"
        },
        "sameAs": [
            "https://facebook.com/vicsroyalbeauty",
            "https://instagram.com/vicsroyalbeauty",
            "https://twitter.com/vicsroyalbeauty"
        ],
        "potentialAction": {
            "@type": "SearchAction",
            "target": "{{ request.scheme }}://{{ request.get_host }}/products/?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    {% endblock %}
    
    <!-- Performance Monitoring -->
    {% if not debug %}
    <script>
        // Performance monitoring
        window.addEventListener('load', function() {
            if ('performance' in window) {
                const perfData = performance.getEntriesByType('navigation')[0];
                if (perfData) {
                    fetch('/log-error/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify({
                            type: 'performance',
                            data: {
                                loadTime: perfData.loadEventEnd - perfData.loadEventStart,
                                domContentLoaded: perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart,
                                firstPaint: performance.getEntriesByName('first-paint')[0]?.startTime,
                                firstContentfulPaint: performance.getEntriesByName('first-contentful-paint')[0]?.startTime
                            }
                        })
                    });
                }
            }
        });
    </script>
    {% endif %}
    
    <meta name="apple-mobile-web-app-title" content="Vics Royal Beauty" />
    <link rel="manifest" href="{% static 'images/site.webmanifest' %}" />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Tailwind configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
              primary: {
                50: '#FDF2F8',
                100: '#FCE7F3',
                200: '#FBCFE8',
                300: '#F9A8D4',
                400: '#F472B6',
                500: '#EC4899',
                600: '#DB2777',
                700: '#BE185D',
                800: '#9D174D',
                900: '#831843',
              },
              accent: {
                50: '#F0FDFA',
                100: '#CCFBF1',
                200: '#99F6E4',
                300: '#5EEAD4',
                400: '#2DD4BF',
                500: '#14B8A6',
                600: '#0D9488',
                700: '#0F766E',
                800: '#115E59',
                900: '#134E4A',
              },
                    },
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
          },
        },
      };
    </script>
    
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    
    <style>
      [x-cloak] {
        display: none !important;
      }
    </style>
    <!-- Alpine.js -->
    <script
      defer
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
</head>
<body class="font-sans bg-white">
    <!-- Mobile Sidebar -->
    <div
      id="mobileSidebar"
      class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden lg:hidden"
    >
      <div
        class="fixed inset-y-0 left-0 w-64 bg-white shadow-lg transform -translate-x-full transition-transform duration-300 ease-in-out"
        id="sidebarPanel"
      >
            <div class="flex flex-col h-full">
                <!-- Close Button -->
                <div class="p-4 border-b flex justify-between items-center">
                    <h2 class="text-xl font-serif">Menu</h2>
            <button
              onclick="toggleMobileSidebar()"
              class="text-gray-500 hover:text-gray-700"
            >
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <!-- Navigation Links -->
                <nav class="flex-1 px-4 py-6 space-y-4">
            <a
              href="{% url 'core:home' %}"
              class="block py-2 hover:text-primary-700 transition duration-300"
            >
                        <i class="fas fa-home w-6"></i> Home
                    </a>
                                <a
              href="{% url 'products:categories' %}"
              class="block py-2 hover:text-primary-700 transition duration-300"
            >
                        <i class="fas fa-store w-6"></i> Shop
                    </a>
            <a
              href="{% url 'core:about' %}"
              class="block py-2 hover:text-primary-700 transition duration-300"
            >
                        <i class="fas fa-info-circle w-6"></i> About
                    </a>
            <a
              href="{% url 'core:contact' %}"
              class="block py-2 hover:text-primary-700 transition duration-300"
            >
                        <i class="fas fa-envelope w-6"></i> Contact
                    </a>
                    {% if user.is_authenticated %}
                    <div class="border-t my-4"></div>
            <a
              href="{% url 'accounts:profile' %}"
              class="block py-2 hover:text-primary-700 transition duration-300"
            >
                        <i class="fas fa-user-circle w-6"></i> My Account
                    </a>
            <a
              href="{% url 'accounts:wishlist' %}"
              class="block py-2 hover:text-primary-700 transition duration-300"
            >
                        <i class="far fa-heart w-6"></i> My Wishlist
                    </a>
            <form
              method="post"
              action="{% url 'accounts:logout' %}"
              class="block"
            >
                        {% csrf_token %}
              <button
                type="submit"
                class="w-full text-left py-2 hover:text-primary-700 transition duration-300"
              >
                        <i class="fas fa-sign-out-alt w-6"></i> Logout
                        </button>
                    </form>
                    {% endif %}
                </nav>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-40">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <!-- Mobile Menu Button -->
                <button
                    onclick="toggleMobileSidebar()"
                    class="lg:hidden text-gray-500 hover:text-gray-700"
                >
                    <i class="fas fa-bars text-xl"></i>
                </button>
                
                <!-- Logo -->
                <a href="{% url 'core:home' %}" class="flex items-center space-x-2">
                    <span class="font-serif italic text-lg md:text-xl lg:text-2xl text-primary-700 font-medium">Vics Royal Beauty</span>
                    <img src="{% static 'images/logo.jpg' %}" alt="Vics Royal Beauty" class="h-8 w-auto md:h-10 lg:h-12 object-contain">
                </a>
                
                <!-- Desktop Navigation -->
                <nav class="hidden lg:flex items-center space-x-8">
            <a
              href="{% url 'core:home' %}"
              class="hover:text-primary-700 transition duration-300"
              >Home</a
            >
            <a
              href="{% url 'products:categories' %}"
              class="hover:text-primary-700 transition duration-300"
              >Shop</a
            >
            <a
              href="{% url 'core:about' %}"
              class="hover:text-primary-700 transition duration-300"
              >About</a
            >
            <a
              href="{% url 'core:contact' %}"
              class="hover:text-primary-700 transition duration-300"
              >Contact</a
            >
                </nav>
                
                <!-- Search and Icons -->
                <div class="flex items-center space-x-4">
                    <!-- Search -->
                    <div class="relative hidden md:block">
              <input
                type="text"
                placeholder="Search..."
                class="w-48 pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:border-primary-700"
              />
              <i
                class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
              ></i>
                    </div>
                    
                    <!-- Mobile Search Button -->
            <button
              onclick="toggleMobileSearch()"
              class="md:hidden text-gray-500 hover:text-gray-700"
            >
                        <i class="fas fa-search text-xl"></i>
                    </button>
                    
                    <!-- Wishlist -->
            <a
              href="{% url 'accounts:wishlist' %}"
              class="text-gray-500 hover:text-primary-700 relative"
            >
                        <i class="far fa-heart text-xl"></i>
              <span
                id="wishlist-count"
                class="absolute -top-2 -right-2 bg-primary-700 text-white w-5 h-5 rounded-full flex items-center justify-center text-xs {% if not wishlist_count %}hidden{% endif %}"
              >
                {{ wishlist_count|default:0 }}
                            </span>
                    </a>

                    <!-- Cart -->
            <a
              href="{% url 'orders:cart_detail' %}"
              class="text-gray-500 hover:text-primary-700 relative"
            >
                        <i class="fas fa-cart-shopping text-xl"></i>
              <span
                id="cart-count"
                class="absolute -top-2 -right-2 bg-primary-700 text-white w-5 h-5 rounded-full flex items-center justify-center text-xs {% if not cart_count %}hidden{% endif %}"
              >
                {{ cart_count|default:0 }}
                            </span>
                    </a>
                    
                    <!-- Desktop User Menu -->
                    <div class="hidden lg:block relative" x-data="{ open: false }">
                        {% if user.is_authenticated %}
              <button
                @click="open = !open"
                class="flex items-center space-x-1 text-gray-500 hover:text-primary-700"
              >
                            <i class="fas fa-user text-xl"></i>
                <i
                  class="fas fa-chevron-down text-xs"
                  :class="{ 'transform rotate-180': open }"
                ></i>
                        </button>
              <div
                x-show="open"
                             x-cloak
                style="display: none"
                             @click.outside="open = false"
                             x-transition:enter="transition ease-out duration-200"
                             x-transition:enter-start="opacity-0 transform scale-95"
                             x-transition:enter-end="opacity-100 transform scale-100"
                             x-transition:leave="transition ease-in duration-75"
                             x-transition:leave-start="opacity-100 transform scale-100"
                             x-transition:leave-end="opacity-0 transform scale-95"
                class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-50"
              >
                <a
                  href="{% url 'accounts:profile' %}"
                               @click="open = false"
                  class="block px-4 py-2 hover:bg-primary-50"
                >
                                <i class="fas fa-user-circle mr-2"></i>My Account
                            </a>
                <a
                  href="{% url 'accounts:wishlist' %}"
                               @click="open = false"
                  class="block px-4 py-2 hover:bg-primary-50"
                >
                                <i class="far fa-heart mr-2"></i>My Wishlist
                            </a>
                            <div class="border-t my-2"></div>
                <form
                  method="post"
                  action="{% url 'accounts:logout' %}"
                  class="block"
                >
                                {% csrf_token %}
                  <button
                    type="submit"
                               @click="open = false"
                    class="w-full text-left px-4 py-2 hover:bg-primary-50"
                  >
                                <i class="fas fa-sign-out-alt mr-2"></i>Logout
                                </button>
                            </form>
                        </div>
                        {% else %}
              <a
                href="{% url 'accounts:login' %}"
                class="text-gray-500 hover:text-primary-700"
              >
                            <i class="fas fa-user text-xl"></i>
                        </a>
                        {% endif %}
                    </div>
                </div>
                </div>
            </div>
            
        <!-- Mobile Search Bar (Hidden by default) -->
        <div id="mobileSearch" class="lg:hidden hidden border-t">
            <div class="container mx-auto px-4 py-3">
                <div class="relative">
            <input
              type="text"
              placeholder="Search..."
              class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:border-primary-700"
            />
            <i
              class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
            ></i>
                </div>
            </div>
        </div>
    </header>

    {% include 'includes/breadcrumbs.html' %}

    <!-- Main Content -->
    <main class="min-h-screen">
        {% if messages %}
            <div class="container mx-auto px-4 py-4">
                {% for message in messages %}
        <div
          class="p-4 mb-4 rounded-lg {% if message.tags == 'error' %}bg-accent-50 text-accent-800{% else %}bg-primary-50 text-primary-800{% endif %}"
        >
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
      {% endif %} {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-primary-900 text-white py-16">
        <div class="container mx-auto px-4 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <!-- About -->
                <div>
            <h3 class="text-xl font-serif mb-4">About Vics Royal Beauty</h3>
            <p class="text-gray-400">
              Experience luxury hair care with our premium collection of hair
              products and accessories.
            </p>
                </div>
                
                <!-- Quick Links -->
                <div>
                    <h3 class="text-xl font-serif mb-4">Quick Links</h3>
                    <ul class="space-y-2 text-gray-400">
              <li>
                <a href="{% url 'core:about' %}" class="hover:text-primary-300"
                  >About Us</a
                >
              </li>
              <li>
                <a href="{% url 'core:contact' %}" class="hover:text-primary-300"
                  >Contact Us</a
                >
              </li>
                        <li><a href="#" class="hover:text-primary-300">Privacy Policy</a></li>
              <li>
                <a href="#" class="hover:text-primary-300">Terms & Conditions</a>
              </li>
                    </ul>
                </div>
                
                <!-- Customer Service -->
                <div>
                    <h3 class="text-xl font-serif mb-4">Customer Service</h3>
                    <ul class="space-y-2 text-gray-400">
              <li>
                <a href="#" class="hover:text-primary-300">Shipping Information</a>
              </li>
              <li>
                <a href="#" class="hover:text-primary-300">Returns & Exchanges</a>
              </li>
                        <li><a href="#" class="hover:text-primary-300">Size Guide</a></li>
                        <li><a href="#" class="hover:text-primary-300">FAQ</a></li>
                    </ul>
                </div>
                
                <!-- Newsletter -->
                <div>
                    <h3 class="text-xl font-serif mb-4">Newsletter</h3>
            <p class="text-gray-400 mb-4">
              Subscribe to receive updates, access to exclusive deals, and more.
            </p>
                    <form id="newsletter-form" class="space-y-4">
                        {% csrf_token %}
                        <div class="relative">
                <input
                  type="email"
                  name="email"
                  id="newsletter-email"
                  placeholder="Enter your email address"
                  required
                  class="w-full px-4 py-2 bg-white bg-opacity-10 border border-gray-600 rounded-full focus:outline-none focus:border-primary-700"
                />
                <div
                  id="newsletter-error"
                  class="absolute left-0 -bottom-6 text-sm text-red-500 hidden"
                ></div>
                        </div>
              <button
                type="submit"
                class="w-full bg-primary-700 hover:bg-primary-800 text-white py-2 rounded-full transition duration-300 relative"
              >
                            <span id="newsletter-button-text">Subscribe</span>
                <span
                  id="newsletter-loading"
                  class="absolute inset-0 flex items-center justify-center hidden"
                >
                                <i class="fas fa-spinner fa-spin"></i>
                            </span>
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Bottom Footer -->
        <div
          class="border-t border-gray-800 mt-12 pt-8 flex flex-col md:flex-row justify-between items-center"
        >
          <p class="text-gray-400">
            &copy; 2024 Vics Royal Beauty. All rights reserved.
          </p>
                <div class="flex space-x-4 mt-4 md:mt-0">
            <a href="#" class="text-gray-400 hover:text-primary-300"
              ><i class="fab fa-facebook-f"></i
            ></a>
            <a href="#" class="text-gray-400 hover:text-primary-300"
              ><i class="fab fa-twitter"></i
            ></a>
            <a href="#" class="text-gray-400 hover:text-primary-300"
              ><i class="fab fa-instagram"></i
            ></a>
            <a href="#" class="text-gray-400 hover:text-primary-300"
              ><i class="fab fa-pinterest-p"></i
            ></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Add notification container at the end of body -->
    <div id="notification" class="notification" style="display: none">
        <span id="notification-message"></span>
    </div>

    <script>
        // Add notification styles
        const style = document.createElement('style');
        style.textContent = `
            .notification {
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem;
                border-radius: 0.5rem;
                background-color: #4F46E5;
                color: white;
                z-index: 50;
                transform: translateX(100%);
                transition: transform 0.3s ease-in-out;
            }
            .notification.show {
                transform: translateX(0);
            }
        `;
        document.head.appendChild(style);
    </script>

    <script>
        function toggleMobileSidebar() {
            const sidebar = document.getElementById('mobileSidebar');
            const panel = document.getElementById('sidebarPanel');
            
            if (sidebar.classList.contains('hidden')) {
                sidebar.classList.remove('hidden');
                setTimeout(() => {
                    panel.classList.remove('-translate-x-full');
                }, 100);
            } else {
                panel.classList.add('-translate-x-full');
                setTimeout(() => {
                    sidebar.classList.add('hidden');
                }, 300);
            }
        }
        
        function toggleMobileSearch() {
            const searchBar = document.getElementById('mobileSearch');
            searchBar.classList.toggle('hidden');
        }
        
        // Close sidebar when clicking outside
      document
        .getElementById('mobileSidebar')
        .addEventListener('click', function (event) {
            if (event.target === this) {
                toggleMobileSidebar();
            }
        });
    </script>

    <script>
      document
        .getElementById('newsletter-form')
        .addEventListener('submit', function (e) {
            e.preventDefault();
            
            const form = this;
            const email = document.getElementById('newsletter-email').value;
            const buttonText = document.getElementById('newsletter-button-text');
            const loading = document.getElementById('newsletter-loading');
            const errorDiv = document.getElementById('newsletter-error');
            
            // Reset error message
            errorDiv.textContent = '';
            errorDiv.classList.add('hidden');
            
            // Show loading state
            buttonText.classList.add('invisible');
            loading.classList.remove('hidden');
            form.querySelector('button').disabled = true;
            
            fetch('{% url "core:newsletter_subscribe" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
              'X-CSRFToken': '{{ csrf_token }}',
                },
            body: `email=${encodeURIComponent(email)}`,
            })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    showNotification(data.message, 'success');
                    form.reset();
                } else {
                    errorDiv.textContent = data.message;
                    errorDiv.classList.remove('hidden');
                }
            })
            .catch((error) => {
                console.error('Error:', error);
                errorDiv.textContent = 'An error occurred. Please try again.';
                errorDiv.classList.remove('hidden');
            })
            .finally(() => {
                // Reset button state
                buttonText.classList.remove('invisible');
                loading.classList.add('hidden');
                form.querySelector('button').disabled = false;
            });
        });

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed bottom-4 right-4 z-50 p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-y-full ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            } text-white`;
            notification.textContent = message;
            document.body.appendChild(notification);

            // Slide in
            requestAnimationFrame(() => {
                notification.classList.remove('translate-y-full');
            });

            // Slide out and remove after delay
            setTimeout(() => {
                notification.classList.add('translate-y-full');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }
    </script>

    <!-- Robust JavaScript Error Logging -->
<script>
function getCSRFToken() {
    const name = 'csrftoken';
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.startsWith(name + '=')) {
            return decodeURIComponent(cookie.substring(name.length + 1));
        }
    }
    return '';
}

window.onerror = function(message, source, lineno, colno, error) {
    // Only send if there is a real message or stack
    if (!message && !(error && error.stack)) return;

    fetch('/log-error/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCSRFToken()
        },
        body: JSON.stringify({
            type: 'js',
            message: message || null,
            source: source || null,
            lineno: lineno || null,
            colno: colno || null,
            stack: error && error.stack ? error.stack : null
        })
    });
};
</script>

    <!-- Error Tracking -->
    {% if not debug %}
    <script src="https://browser.sentry-cdn.com/7.92.0/bundle.tracing.min.js" crossorigin="anonymous"></script>
    <script>
Sentry.init({
  dsn: '{{ GLITCHTIP_DSN }}',
  integrations: [
    new Sentry.BrowserTracing({
      tracePropagationTargets: ["localhost", "yourdomain.com", /^https:\/\/api\.yourdomain\.com/],
    }),
  ],
  tracesSampleRate: 1.0,
  environment: '{{ ENVIRONMENT|default:"production" }}',
});
</script>
    {% endif %}
    
    {% include 'includes/scripts.html' %}
    {% block extra_js %}{% endblock %}
</body>
</html>
